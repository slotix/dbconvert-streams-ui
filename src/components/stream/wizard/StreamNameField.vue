<template>
  <div
    class="bg-linear-to-br from-slate-50 to-white rounded-xl p-6 border border-gray-100 shadow-sm"
  >
    <div>
      <label for="streamName" class="block text-sm font-semibold text-gray-900">Stream Name</label>
      <div class="mt-2">
        <input
          id="streamName"
          v-model="streamName"
          type="text"
          class="block w-full rounded-lg border-gray-200 shadow-sm focus:border-teal-600 focus:ring-teal-600 sm:text-sm transition-all duration-200"
          :placeholder="autoGeneratedName || 'Enter custom name or leave blank for auto-generation'"
        />
      </div>
      <p v-if="!streamName && autoGeneratedName" class="mt-2 text-sm text-gray-600">
        Auto-generated name:
        <span
          class="font-semibold bg-linear-to-r from-blue-600 to-teal-600 bg-clip-text text-transparent"
          >{{ autoGeneratedName }}</span
        >
      </p>
      <p v-else class="mt-2 text-sm text-gray-500">
        Leave blank for auto-generated name or enter a custom name.
      </p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useStreamsStore } from '@/stores/streamConfig'

interface Props {
  sourceConnectionId?: string | null
  targetConnectionId?: string | null
  sourceDatabase?: string | null
  targetDatabase?: string | null
}

const props = withDefaults(defineProps<Props>(), {
  sourceConnectionId: null,
  targetConnectionId: null,
  sourceDatabase: null,
  targetDatabase: null
})

const streamsStore = useStreamsStore()

const streamName = computed({
  get: () => streamsStore.currentStreamConfig?.name || '',
  set: (value) => {
    if (streamsStore.currentStreamConfig) {
      streamsStore.currentStreamConfig.name = value
    }
  }
})

const autoGeneratedName = computed(() => {
  if (!props.sourceConnectionId || !props.targetConnectionId) {
    return ''
  }

  // Use the existing store method to generate the name
  const tables = streamsStore.currentStreamConfig?.tables || []
  const targetFileFormat = streamsStore.currentStreamConfig?.targetFileFormat

  return streamsStore.generateDefaultStreamConfigName(
    props.sourceConnectionId,
    props.targetConnectionId,
    tables,
    props.sourceDatabase || undefined,
    props.targetDatabase || undefined,
    targetFileFormat
  )
})
</script>
